{{define "content"}}
<div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-900">Access Control</h1>
    <p class="mt-1 text-sm text-gray-500">Manage which users can access which projects. Admins have access to all projects by default.</p>
</div>

<!-- Grant access form -->
<div class="bg-white shadow rounded-lg border border-gray-100 p-6 mb-6">
    <h2 class="text-sm font-semibold text-gray-900 mb-3">Grant Access</h2>
    <form method="POST" action="/access/grant" class="flex flex-wrap items-end gap-3">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
        <div>
            <label for="user_id" class="block text-xs font-medium text-gray-500">User</label>
            <select name="user_id" id="user_id" required class="mt-1 rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border">
                {{range .Users}}
                {{if eq .Role "viewer"}}
                <option value="{{.ID}}">{{.Username}}</option>
                {{end}}
                {{end}}
            </select>
        </div>
        <div>
            <label for="project_id" class="block text-xs font-medium text-gray-500">Project</label>
            <select name="project_id" id="project_id" required class="mt-1 rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border">
                {{range .Projects}}
                <option value="{{.ID}}">{{.Name}}</option>
                {{end}}
            </select>
        </div>
        <button type="submit" class="rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 transition-colors">
            Grant
        </button>
    </form>
</div>

<!-- Current access list -->
<div class="overflow-hidden rounded-lg bg-white shadow border border-gray-100">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">User</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Project</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Granted</th>
                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
            {{range .Access}}
            <tr>
                <td class="px-4 py-3 text-sm font-medium text-gray-900">{{.Username}}</td>
                <td class="px-4 py-3 text-sm text-gray-500">{{.ProjectName}}</td>
                <td class="px-4 py-3 text-sm text-gray-500">{{formatDate .GrantedAt}}</td>
                <td class="px-4 py-3 text-sm text-right">
                    <form method="POST" action="/access/revoke" class="inline" onsubmit="return confirm('Revoke access?')">
                        <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
                        <input type="hidden" name="user_id" value="{{.UserID}}">
                        <input type="hidden" name="project_id" value="{{.ProjectID}}">
                        <button type="submit" class="text-red-600 hover:text-red-500">Revoke</button>
                    </form>
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="4" class="px-4 py-8 text-center text-sm text-gray-500">No access grants yet. Use the form above to grant viewer users access to projects.</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>
{{end}}
